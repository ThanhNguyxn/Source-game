const modeSelector=document.getElementById('modeSelector'),gameArea=document.getElementById('gameArea'),canvas=document.getElementById('gameCanvas'),ctx=canvas.getContext('2d'),scoreEl=document.getElementById('score'),livesEl=document.getElementById('lives'),levelEl=document.getElementById('level'),diffEl=document.getElementById('difficultyDisplay');let score=0,lives=3,level=1,difficulty='easy',isPaused=!1,gameLoop=null;const ship={x:canvas.width/2,y:canvas.height/2,angle:0,rotation:0,thrusting:!1,velocityX:0,velocityY:0,radius:15};let bullets=[],asteroids=[],ufos=[];const keys={},diffSettings={easy:{asteroidSpeed:1,count:4,ufoChance:0},medium:{asteroidSpeed:1.5,count:6,ufoChance:0},hard:{asteroidSpeed:2,count:8,ufoChance:0},extreme:{asteroidSpeed:2,count:8,ufoChance:.01}};function startGame(e){difficulty=e;modeSelector.style.display='none',gameArea.style.display='block',diffEl.textContent=e.charAt(0).toUpperCase()+e.slice(1),initGame()}function initGame(){score=0,lives='hard'===difficulty?2:3,level=1,ship.x=canvas.width/2,ship.y=canvas.height/2,ship.angle=0,ship.velocityX=0,ship.velocityY=0,bullets=[],asteroids=[],ufos=[],createAsteroids(diffSettings[difficulty].count),updateDisplay(),gameLoop=requestAnimationFrame(update)}function createAsteroids(e){const t=diffSettings[difficulty].asteroidSpeed;for(let i=0;i<e;i++){let e,i;do e=Math.random()*canvas.width,i=Math.random()*canvas.height;while(Math.hypot(e-ship.x,i-ship.y)<100);asteroids.push({x:e,y:i,vx:2*(Math.random()-.5)*t,vy:2*(Math.random()-.5)*t,radius:50,size:'large'})}}document.addEventListener('keydown',e=>{' '===e.key&&e.preventDefault(),keys[e.key]=!0}),document.addEventListener('keyup',e=>keys[e.key]=!1);function update(){isPaused||(updateShip(),updateBullets(),updateAsteroids(),updateUFOs(),checkCollisions(),0===asteroids.length&&(level++,createAsteroids(diffSettings[difficulty].count+2*level))),draw(),gameLoop=requestAnimationFrame(update)}function updateShip(){keys.ArrowLeft&&(ship.angle-=.1),keys.ArrowRight&&(ship.angle+=.1),keys.ArrowUp?(ship.thrusting=!0,ship.velocityX+=.1*Math.cos(ship.angle),ship.velocityY+=.1*Math.sin(ship.angle)):ship.thrusting=!1,keys[' ']&&bullets.length<4&&(bullets.push({x:ship.x+20*Math.cos(ship.angle),y:ship.y+20*Math.sin(ship.angle),vx:5*Math.cos(ship.angle),vy:5*Math.sin(ship.angle)}),keys[' ']=!1),ship.velocityX*=.99,ship.velocityY*=.99,ship.x+=ship.velocityX,ship.y+=ship.velocityY,ship.x<0&&(ship.x=canvas.width),ship.x>canvas.width&&(ship.x=0),ship.y<0&&(ship.y=canvas.height),ship.y>canvas.height&&(ship.y=0)}function updateBullets(){bullets=bullets.filter(e=>(e.x+=e.vx,e.y+=e.vy,e.x>0&&e.x<canvas.width&&e.y>0&&e.y<canvas.height))}function updateAsteroids(){asteroids.forEach(e=>{e.x+=e.vx,e.y+=e.vy,e.x<-e.radius&&(e.x=canvas.width+e.radius),e.x>canvas.width+e.radius&&(e.x=-e.radius),e.y<-e.radius&&(e.y=canvas.height+e.radius),e.y>canvas.height+e.radius&&(e.y=-e.radius)})}function updateUFOs(){'extreme'===difficulty&&Math.random()<diffSettings.extreme.ufoChance&&ufos.length<2&&ufos.push({x:Math.random()*canvas.width,y:50,vx:2*(Math.random()-.5),radius:20}),ufos.forEach(e=>{e.x+=e.vx,(e.x<0||e.x>canvas.width)&&(e.vx*=-1),Math.random()<.02&&bullets.push({x:e.x,y:e.y,vx:.01*(ship.x-e.x),vy:.01*(ship.y-e.y),enemy:!0})})}function checkCollisions(){asteroids.forEach((e,t)=>{Math.hypot(e.x-ship.x,e.y-ship.y)<e.radius+ship.radius&&(lives--,lives<=0?gameOver():(ship.x=canvas.width/2,ship.y=canvas.height/2,ship.velocityX=0,ship.velocityY=0),updateDisplay()),bullets.forEach((i,a)=>{!i.enemy&&Math.hypot(i.x-e.x,i.y-e.y)<e.radius&&(bullets.splice(a,1),asteroids.splice(t,1),score+='large'===e.size?20:'medium'===e.size?50:100,'large'===e.size?asteroids.push({x:e.x,y:e.y,vx:3*(Math.random()-.5),vy:3*(Math.random()-.5),radius:25,size:'medium'},{x:e.x,y:e.y,vx:3*(Math.random()-.5),vy:3*(Math.random()-.5),radius:25,size:'medium'}):'medium'===e.size&&asteroids.push({x:e.x,y:e.y,vx:4*(Math.random()-.5),vy:4*(Math.random()-.5),radius:10,size:'small'},{x:e.x,y:e.y,vx:4*(Math.random()-.5),vy:4*(Math.random()-.5),radius:10,size:'small'}),updateDisplay())})}),ufos.forEach((e,t)=>{Math.hypot(e.x-ship.x,e.y-ship.y)<e.radius+ship.radius&&(lives--,updateDisplay(),ufos.splice(t,1)),bullets.forEach((i,a)=>{!i.enemy&&Math.hypot(i.x-e.x,i.y-e.y)<e.radius&&(bullets.splice(a,1),ufos.splice(t,1),score+=200,updateDisplay())})}),bullets.forEach((e,t)=>{e.enemy&&Math.hypot(e.x-ship.x,e.y-ship.y)<ship.radius&&(bullets.splice(t,1),lives--,lives<=0&&gameOver(),updateDisplay())})}function draw(){ctx.fillStyle='#000',ctx.fillRect(0,0,canvas.width,canvas.height),ctx.save(),ctx.translate(ship.x,ship.y),ctx.rotate(ship.angle),ctx.strokeStyle='#fff',ctx.lineWidth=2,ctx.beginPath(),ctx.moveTo(15,0),ctx.lineTo(-10,-8),ctx.lineTo(-10,8),ctx.closePath(),ctx.stroke(),ship.thrusting&&(ctx.fillStyle='#f80',ctx.beginPath(),ctx.moveTo(-10,0),ctx.lineTo(-20,-5),ctx.lineTo(-20,5),ctx.closePath(),ctx.fill()),ctx.restore(),ctx.fillStyle='#fff',bullets.forEach(e=>{ctx.beginPath(),ctx.arc(e.x,e.y,2,0,2*Math.PI),ctx.fill()}),ctx.strokeStyle='#888',asteroids.forEach(e=>{ctx.beginPath(),ctx.arc(e.x,e.y,e.radius,0,2*Math.PI),ctx.stroke()}),ctx.fillStyle='#f00',ufos.forEach(e=>{ctx.beginPath(),ctx.arc(e.x,e.y,e.radius,0,2*Math.PI),ctx.fill()})}function updateDisplay(){scoreEl.textContent=score,livesEl.textContent=lives,levelEl.textContent=level}function gameOver(){cancelAnimationFrame(gameLoop),alert(`Game Over!\nScore: ${score}\nLevel: ${level}`),changeDiff()}function togglePause(){isPaused=!isPaused,document.getElementById('pauseBtn').textContent=isPaused?'Resume':'Pause'}function resetGame(){cancelAnimationFrame(gameLoop),initGame()}function changeDiff(){cancelAnimationFrame(gameLoop),gameArea.style.display='none',modeSelector.style.display='block'}document.getElementById('pauseBtn').addEventListener('click',togglePause),document.getElementById('resetBtn').addEventListener('click',resetGame),document.getElementById('changeDiffBtn').addEventListener('click',changeDiff);